2025-06-24 13:10:37,931 INFO    MainThread:7888 [wandb_setup.py:_flush():81] Current SDK version is 0.20.1
2025-06-24 13:10:37,931 INFO    MainThread:7888 [wandb_setup.py:_flush():81] Configure stats pid to 7888
2025-06-24 13:10:37,932 INFO    MainThread:7888 [wandb_setup.py:_flush():81] Loading settings from C:\Users\Sagi\.config\wandb\settings
2025-06-24 13:10:37,932 INFO    MainThread:7888 [wandb_setup.py:_flush():81] Loading settings from D:\Sagi\GCP\GCP\wandb\settings
2025-06-24 13:10:37,932 INFO    MainThread:7888 [wandb_setup.py:_flush():81] Loading settings from environment variables
2025-06-24 13:10:37,932 INFO    MainThread:7888 [wandb_init.py:setup_run_log_directory():703] Logging user logs to work_dir\mask2former_training\mask2former_e15_lre-4_kostanai_afs_buffer_method_changed\wandb\wandb\run-20250624_131037-ke8tk778\logs\debug.log
2025-06-24 13:10:37,932 INFO    MainThread:7888 [wandb_init.py:setup_run_log_directory():704] Logging internal logs to work_dir\mask2former_training\mask2former_e15_lre-4_kostanai_afs_buffer_method_changed\wandb\wandb\run-20250624_131037-ke8tk778\logs\debug-internal.log
2025-06-24 13:10:37,932 INFO    MainThread:7888 [wandb_init.py:init():831] calling init triggers
2025-06-24 13:10:37,932 INFO    MainThread:7888 [wandb_init.py:init():836] wandb.init called with sweep_config: {}
config: {'_wandb': {}}
2025-06-24 13:10:37,932 INFO    MainThread:7888 [wandb_init.py:init():872] starting backend
2025-06-24 13:10:38,158 INFO    MainThread:7888 [wandb_init.py:init():875] sending inform_init request
2025-06-24 13:10:38,178 INFO    MainThread:7888 [wandb_init.py:init():883] backend started and connected
2025-06-24 13:10:38,179 INFO    MainThread:7888 [wandb_init.py:init():956] updated telemetry
2025-06-24 13:10:38,211 INFO    MainThread:7888 [wandb_init.py:init():980] communicating run to backend with 90.0 second timeout
2025-06-24 13:10:39,210 INFO    MainThread:7888 [wandb_init.py:init():1032] starting run threads in backend
2025-06-24 13:10:39,545 INFO    MainThread:7888 [wandb_run.py:_console_start():2453] atexit reg
2025-06-24 13:10:39,545 INFO    MainThread:7888 [wandb_run.py:_redirect():2301] redirect: wrap_raw
2025-06-24 13:10:39,545 INFO    MainThread:7888 [wandb_run.py:_redirect():2370] Wrapping output streams.
2025-06-24 13:10:39,545 INFO    MainThread:7888 [wandb_run.py:_redirect():2393] Redirects installed.
2025-06-24 13:10:39,547 INFO    MainThread:7888 [wandb_init.py:init():1078] run started, returning control to user process
2025-06-24 13:10:39,547 INFO    MainThread:7888 [wandb_run.py:_config_callback():1358] config_cb None None {'dataset_type': 'WHUMixVectorDataset', 'data_root': 'data/kostanai', 'img_norm_cfg': {'mean': [123.675, 116.28, 103.53], 'std': [58.395, 57.12, 57.375], 'to_rgb': True}, 'backend_args': None, 'crop_size': [512, 512], 'batch_augments': [{'type': 'BatchFixedSizePad', 'size': [512, 512], 'img_pad_value': 0, 'pad_mask': True, 'mask_pad_value': 0, 'pad_seg': True, 'seg_pad_value': 255}], 'data_preprocessor': {'type': 'DetDataPreprocessor', 'mean': [123.675, 116.28, 103.53], 'std': [58.395, 57.12, 57.375], 'bgr_to_rgb': True, 'pad_size_divisor': 32, 'pad_mask': True, 'mask_pad_value': 0, 'pad_seg': True, 'seg_pad_value': 255, 'batch_augments': [{'type': 'BatchFixedSizePad', 'size': [512, 512], 'img_pad_value': 0, 'pad_mask': True, 'mask_pad_value': 0, 'pad_seg': True, 'seg_pad_value': 255}]}, 'train_pipeline': [{'type': 'LoadImageFromFile', 'backend_args': None}, {'type': 'LoadAnnotations', 'with_bbox': True, 'with_mask': True, 'poly2mask': False, 'with_poly_json': False}, {'type': 'Resize', 'scale': [512, 512], 'keep_ratio': True}, {'type': 'RandomFlip', 'prob': 0.75, 'direction': ['horizontal', 'vertical', 'diagonal']}, {'type': 'Rotate90', 'prob': 0.75}, {'type': 'PackDetInputs', 'meta_keys': ['img_id', 'img_path', 'ori_shape', 'img_shape', 'scale_factor']}], 'test_pipeline': [{'type': 'LoadImageFromFile', 'backend_args': None}, {'type': 'Resize', 'scale': [512, 512], 'keep_ratio': True}, {'type': 'LoadAnnotations', 'with_bbox': False, 'with_mask': True, 'poly2mask': False, 'with_poly_json': False}, {'type': 'PackDetInputs', 'meta_keys': ['img_id', 'img_path', 'ori_shape', 'img_shape', 'scale_factor']}], 'train_dataloader': {'batch_size': 1, 'num_workers': 1, 'persistent_workers': False, 'sampler': {'type': 'DefaultSampler', 'shuffle': True}, 'batch_sampler': {'type': 'AspectRatioBatchSampler'}, 'dataset': {'type': 'WHUMixVectorDataset', 'data_root': 'data/kostanai', 'pipeline': [{'type': 'LoadImageFromFile', 'backend_args': None}, {'type': 'LoadAnnotations', 'with_bbox': True, 'with_mask': True, 'poly2mask': False, 'with_poly_json': False}, {'type': 'Resize', 'scale': [512, 512], 'keep_ratio': True}, {'type': 'RandomFlip', 'prob': 0.75, 'direction': ['horizontal', 'vertical', 'diagonal']}, {'type': 'Rotate90', 'prob': 0.75}, {'type': 'PackDetInputs', 'meta_keys': ['img_id', 'img_path', 'ori_shape', 'img_shape', 'scale_factor']}], 'backend_args': None, 'ann_file': 'train/train.json', 'data_prefix': {'img': 'train/images'}}}, 'val_dataloader': {'batch_size': 1, 'num_workers': 1, 'persistent_workers': False, 'drop_last': False, 'sampler': {'type': 'DefaultSampler', 'shuffle': False}, 'dataset': {'type': 'WHUMixVectorDataset', 'data_root': 'data/kostanai', 'pipeline': [{'type': 'LoadImageFromFile', 'backend_args': None}, {'type': 'Resize', 'scale': [512, 512], 'keep_ratio': True}, {'type': 'LoadAnnotations', 'with_bbox': False, 'with_mask': True, 'poly2mask': False, 'with_poly_json': False}, {'type': 'PackDetInputs', 'meta_keys': ['img_id', 'img_path', 'ori_shape', 'img_shape', 'scale_factor']}], 'backend_args': None, 'ann_file': 'val/val.json', 'data_prefix': {'img': 'val/images'}, 'test_mode': True}}, 'test_dataloader': {'batch_size': 1, 'num_workers': 1, 'persistent_workers': False, 'drop_last': False, 'sampler': {'type': 'DefaultSampler', 'shuffle': False}, 'dataset': {'type': 'WHUMixVectorDataset', 'data_root': 'data/kostanai', 'pipeline': [{'type': 'LoadImageFromFile', 'backend_args': None}, {'type': 'Resize', 'scale': [512, 512], 'keep_ratio': True}, {'type': 'LoadAnnotations', 'with_bbox': False, 'with_mask': True, 'poly2mask': False, 'with_poly_json': False}, {'type': 'PackDetInputs', 'meta_keys': ['img_id', 'img_path', 'ori_shape', 'img_shape', 'scale_factor']}], 'backend_args': None, 'data_prefix': {'img': 'test/images'}, 'ann_file': 'test/test.json', 'test_mode': True}}, 'default_scope': 'mmdet', 'default_hooks': {'timer': {'type': 'IterTimerHook'}, 'logger': {'type': 'LoggerHook', 'interval': 10}, 'param_scheduler': {'type': 'ParamSchedulerHook'}, 'checkpoint': {'type': 'CheckpointHook', 'interval': 1, 'by_epoch': True, 'save_last': True, 'max_keep_ckpts': 1}, 'sampler_seed': {'type': 'DistSamplerSeedHook'}, 'visualization': {'type': 'TanmlhVisualizationHook', 'draw': True, 'interval': 10}}, 'env_cfg': {'cudnn_benchmark': False, 'mp_cfg': {'mp_start_method': 'fork', 'opencv_num_threads': 0}, 'dist_cfg': {'backend': 'nccl'}}, 'vis_backends': [{'type': 'WandbVisBackend', 'init_kwargs': {'project': 'building-segmentation-gcp', 'name': 'mask2former_e15_lre-4_kostanai_afs_buffer_method_changed', 'group': 'mask2former_training', 'resume': 'never', 'allow_val_change': True}, 'save_dir': 'work_dir\\mask2former_training\\mask2former_e15_lre-4_kostanai_afs_buffer_method_changed\\wandb'}], 'visualizer': {'type': 'TanmlhVisualizer', 'vis_backends': [{'type': 'WandbVisBackend', 'init_kwargs': {'project': 'building-segmentation-gcp', 'name': 'mask2former_e15_lre-4_kostanai_afs_buffer_method_changed', 'group': 'mask2former_training', 'resume': 'never', 'allow_val_change': True}, 'save_dir': 'work_dir\\mask2former_training\\mask2former_e15_lre-4_kostanai_afs_buffer_method_changed\\wandb'}], 'name': 'visualizer'}, 'log_processor': {'type': 'LogProcessor', 'window_size': 10, 'by_epoch': True}, 'log_level': 'INFO', 'load_from': 'checkpoints/mask2former_r50_pretrained_50e_whu-mix-vector.pth', 'resume': False, 'num_things_classes': 1, 'num_stuff_classes': 0, 'num_classes': 1, 'model': {'type': 'Mask2Former', 'data_preprocessor': {'type': 'DetDataPreprocessor', 'mean': [123.675, 116.28, 103.53], 'std': [58.395, 57.12, 57.375], 'bgr_to_rgb': True, 'pad_size_divisor': 32, 'pad_mask': True, 'mask_pad_value': 0, 'pad_seg': True, 'seg_pad_value': 255}, 'backbone': {'type': 'ResNet', 'depth': 50, 'num_stages': 4, 'out_indices': [0, 1, 2, 3], 'frozen_stages': -1, 'norm_cfg': {'type': 'BN', 'requires_grad': False}, 'norm_eval': True, 'style': 'pytorch', 'init_cfg': {'type': 'Pretrained', 'checkpoint': 'torchvision://resnet50'}}, 'panoptic_head': {'type': 'Mask2FormerHead', 'in_channels': [256, 512, 1024, 2048], 'strides': [4, 8, 16, 32], 'feat_channels': 256, 'out_channels': 256, 'num_things_classes': 1, 'num_stuff_classes': 0, 'num_queries': 300, 'num_transformer_feat_level': 3, 'pixel_decoder': {'type': 'MSDeformAttnPixelDecoder', 'num_outs': 3, 'norm_cfg': {'type': 'GN', 'num_groups': 32}, 'act_cfg': {'type': 'ReLU'}, 'encoder': {'num_layers': 6, 'layer_cfg': {'self_attn_cfg': {'embed_dims': 256, 'num_heads': 8, 'num_levels': 3, 'num_points': 4, 'dropout': 0.0, 'batch_first': True}, 'ffn_cfg': {'embed_dims': 256, 'feedforward_channels': 1024, 'num_fcs': 2, 'ffn_drop': 0.0, 'act_cfg': {'type': 'ReLU', 'inplace': True}}}}, 'positional_encoding': {'num_feats': 128, 'normalize': True}}, 'enforce_decoder_input_project': False, 'positional_encoding': {'num_feats': 128, 'normalize': True}, 'transformer_decoder': {'return_intermediate': True, 'num_layers': 9, 'layer_cfg': {'self_attn_cfg': {'embed_dims': 256, 'num_heads': 8, 'dropout': 0.0, 'batch_first': True}, 'cross_attn_cfg': {'embed_dims': 256, 'num_heads': 8, 'dropout': 0.0, 'batch_first': True}, 'ffn_cfg': {'embed_dims': 256, 'feedforward_channels': 2048, 'num_fcs': 2, 'ffn_drop': 0.0, 'act_cfg': {'type': 'ReLU', 'inplace': True}}}, 'init_cfg': None}, 'loss_cls': {'type': 'CrossEntropyLoss', 'use_sigmoid': False, 'loss_weight': 2.0, 'reduction': 'mean', 'class_weight': [1.0, 0.1]}, 'loss_mask': {'type': 'CrossEntropyLoss', 'use_sigmoid': True, 'reduction': 'mean', 'loss_weight': 5.0}, 'loss_dice': {'type': 'DiceLoss', 'use_sigmoid': True, 'activate': True, 'reduction': 'mean', 'naive_dice': True, 'eps': 1.0, 'loss_weight': 5.0}}, 'panoptic_fusion_head': {'type': 'MaskFormerFusionHead', 'num_things_classes': 1, 'num_stuff_classes': 0, 'loss_panoptic': None, 'init_cfg': None}, 'train_cfg': {'num_points': 12544, 'oversample_ratio': 3.0, 'importance_sample_ratio': 0.75, 'assigner': {'type': 'HungarianAssigner', 'match_costs': [{'type': 'ClassificationCost', 'weight': 2.0}, {'type': 'CrossEntropyLossCost', 'weight': 5.0, 'use_sigmoid': True}, {'type': 'DiceCost', 'weight': 5.0, 'pred_act': True, 'eps': 1.0}]}, 'sampler': {'type': 'MaskPseudoSampler'}}, 'test_cfg': {'panoptic_on': False, 'semantic_on': False, 'instance_on': True, 'max_per_image': 200, 'iou_thr': 0.8, 'filter_low_score': False}, 'init_cfg': None}, 'val_evaluator': [{'type': 'CocoMetric', 'ann_file': 'data/kostanai/val/val.json', 'metric': ['segm'], 'backend_args': None}], 'test_evaluator': [{'type': 'CocoMetric', 'ann_file': 'data/kostanai/test/test.json', 'metric': ['segm'], 'backend_args': None}], 'embed_multi': {'lr_mult': 1.0, 'decay_mult': 0.0}, 'optim_wrapper': {'type': 'OptimWrapper', 'optimizer': {'type': 'AdamW', 'lr': 5e-05, 'weight_decay': 0.05, 'eps': 1e-08, 'betas': [0.9, 0.999]}, 'paramwise_cfg': {'custom_keys': {'backbone': {'lr_mult': 0.1, 'decay_mult': 1.0}, 'query_embed': {'lr_mult': 1.0, 'decay_mult': 0.0}, 'query_feat': {'lr_mult': 1.0, 'decay_mult': 0.0}, 'level_embed': {'lr_mult': 1.0, 'decay_mult': 0.0}}, 'norm_decay_mult': 0.0}, 'clip_grad': {'max_norm': 0.01, 'norm_type': 2}}, 'max_epochs': 10, 'param_scheduler': [{'type': 'LinearLR', 'start_factor': 0.001, 'by_epoch': False, 'begin': 0, 'end': 1000}, {'type': 'MultiStepLR', 'begin': 0, 'end': 10, 'by_epoch': True, 'milestones': [40], 'gamma': 0.1}], 'train_cfg': {'type': 'EpochBasedTrainLoop', 'max_epochs': 10, 'val_interval': 1}, 'val_cfg': {'type': 'ValLoop'}, 'test_cfg': {'type': 'TestLoop'}, 'auto_scale_lr': {'enable': True, 'base_batch_size': 2}, 'log_config': {'hooks': [{'type': 'TextLoggerHook'}, {'type': 'MMDetWandbHook', 'init_kwargs': {'project': 'building-segmentation-gcp', 'name': 'mask2former_e15_lre-4_kostanai_afs_buffer_method_changed', 'group': 'mask2former_training', 'resume': 'never', 'allow_val_change': True}, 'interval': 10, 'log_checkpoint': True, 'log_checkpoint_metadata': True, 'num_eval_images': 10}]}, 'launcher': 'none', 'work_dir': 'work_dir\\mask2former_training\\mask2former_e15_lre-4_kostanai_afs_buffer_method_changed'}
2025-06-24 13:10:42,253 INFO    MainThread:7888 [wandb_run.py:_config_callback():1358] config_cb None None {'_wandb': {'code_path': 'source-building-segmentation-gcp-tools_train.py'}}
2025-06-24 13:12:51,676 INFO    MsgRouterThr:7888 [mailbox.py:close():129] [no run ID] Closing mailbox, abandoning 1 handles.
